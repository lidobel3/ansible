---
# roles/bdd/tasks/psycopg2.yml

# -----------------------
# 1. Dépendances système
# -----------------------
- name: Install build dependencies (Debian/Ubuntu)
  apt:
    name:
      - python3-dev
      - libpq-dev
      - build-essential
      - pkg-config
      - python3-setuptools
      - python3-wheel
    state: present
    update_cache: yes
  when: ansible_os_family == "Debian"

# -----------------------
# 2. Upgrade pip (Critical)
# -----------------------
- name: Upgrade pip
  command: python3 -m pip install --upgrade pip
  changed_when: false

# -----------------------
# 3. Installer psycopg2-binary compatible avec vieux OS
# -----------------------
- name: Install psycopg2 (binary, compatible)
  pip:
    name: psycopg2-binary==2.9.8
    state: present